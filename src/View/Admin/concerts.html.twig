{# this instruction forces escaping of text #}
{% autoescape 'html' %}


{% extends 'layout.html.twig' %}

{# TODO :
● «sélectionner une entrée» ds les 2 combo ...
● style : grisé, avec marqué «passé» pr anciens concerts ...
● TOUT LE BACKEND !
● affichage par défaut : une section / critère de tri
● retour visuel non-JS :
    si heure entrée pas bien ...
● retour visuel JS :
si heure entrée == mauvais format
si date/heure fin < date/heure départ
● retour d'erreur ...
_ JS : BdDial confirmation suppression enreg. en .needJS
    → version sans JS : formulaire caché rendu visible par input:checked ...

_ NOTE : This page will work at two levels:
 1) without JS. all is done through server-side validation
    → write .noJS and warning banner.
 2) with JS
    → write .needJS. client-side + server-side validation
_ client-side input validation of hour through JS;
_ AJAX requests for modifying more than 1 entry per POST request
_ jquery hook to show # of modified items, modified entries, ...
#}

{% block title %}Festizik – administration des concerts{% endblock %}

{% block keywords %}festizik,concerts,administration{% endblock %}


{% block stylesheet %}
    {{ parent() }}
    <link rel="stylesheet" href="/assets/css/adminConcert.css">
{% endblock %}



{# needed variables : sceneNames[] selectedScene #}
{% block selectForScene %}
    <label class="form-group">
        Scène&nbsp:
        <select name="scene">
            {# using scene names instead of their id seems slower but more secure #}
            {% for name in sceneNames %}
                <option value="{{ name }}" {% if name == selectedScene %}selected{% endif %}>
                    {{ name }}
                </option>
            {% endfor %}

{#TODO : WRITE JS to make it work #}
{#TODO : Write .needJS #}
            {# this one is visible only if JS is operational#}
                <option value="newScene" class="needJS">
                    Nouvelle scène&nbsp...
                </option>
        </select>
    </label>
{% endblock %}


{# need variables : artistNames[] selectedScene #}
{% block selectForArtist %}
    <label class="form-group">
        Artiste&nbsp;:
        <select name="artist">
            {% for name in artistNames %}
                <option value="name" {% if name == selectedArtist %}selected{% endif %}>
                    {{ name }}
                </option>
            {% endfor %}

{#TODO : WRITE JS to make it work #}
{#TODO : Write .needJS #}
            {# this one is visible only if JS is operational#}
            <option value="newScene" class="needJS">
                Nouvel artiste&nbsp...
            </option>
        </select>
    </label>
{% endblock %}


{% block content %}
    <header>
        <svg xmlns="http://www.w3.org/2000/svg"
             viewBox="0 0 100 100" preserveAspectRatio="none">
            <polygon fill="orange" points="0,0 100,100 100,0"/>
            <line stroke="darkred" x1="0" y1="0" x2="100" y2="100" />
        </svg>

        <h1>Les concerts</h1>
    </header>

    <hr/>

    {% include 'errorList.html.twig' %}

    <nav>
        <form method="GET" action="" class="border border-info p-1 m-2 sublined">
            <p class="mb-0 font-weight-bold font-weight-italic">Trier&nbsp;...</p>

              {% for prop in sortableProperties %}
                <button type="submit" class="btn btn-info {% if prop.name == actualSort %}active{% endif %}"
                    title="recharger la page avec un ordre différent de tri"
                    name="sortBy" value="{{prop.name}}">
                    par {{prop.label}}
                </button>
              {% endfor %}

                <button type="submit" class="btn btn-info float-right"
                        name="sortBy" value="{{ actualSort }}"
                        title="recharger la page avec les même critères de tri">
                    <img src="/assets/images/sync.svg" alt="">
                    Recharger la page
                </button>

        </form>
    </nav>



    <main>
        <article class="bordered m-2">

            {# "input[type=checkbox]:checked + elem" trick #}
            <label for="shower1" class="btn btn-primary" role="button">
                <span class="badge badge-light">
                    <img src="/assets/images/plus.svg" alt="">
                </span>
                Créer nouvelle entrée ...
            </label>
            <input type="checkbox" id="shower1" class="showNext" aria-hidden="true">

            <form method="POST" action="" class="unHiddenable">
                <div>
                    <img class="img-fluid float-right img-thumbnail downsized"
                         src="" title="" alt="">
                </div>

                {% set selectedScene = '' %}
                {{ block('selectForScene') }}

                <div class="form-group">
                    <label class="mr-2">
                        Date&nbsp:
                        <input type="date" name="DateLocale"
                                {# beware of the format we NEED to the browser : "Y-m-d"! #}
                               value="{{ 'now' | date('Y-m-d') }}">
                    </label>

                    <label>
                        Heure&nbsp:
                        <input type="hour" name="hour"
                               value="{{ 'now' | date('H\\hi\\m') }}">
                    </label>
                </div>

                {% set selectedArtist = '' %}
                {{ block('selectForArtist') }}

                <div class="form-group">
                    <label class="form-group">
                        <strong>Concert annulé</strong>
                        <input type="checkbox" name="cancelled">
                    </label>

                    <button type="submit" name="modify-{{ concert.Id }}"
                            class="btn btn-primary m-2 float-right"
                            title="Envoyer les changements effectués vers le serveur">
                        <span class="badge badge-light">
                            <img src="/assets/images/cloud-upload.svg" alt="">
                        </span>
                        Envoyer
                    </button>

                    <button type="reset" class="btn btn-secondary m-2 float-right"
                            title="Annuler cet ajout">
                        <span class="badge badge-light">
                            <img src="/assets/images/trashcan.svg" alt="">
                        </span>
                        Annuler
                    </button>
                </div>

            </form>
        </article>

      {% for concert in concerts %}
        <article class="bordered m-2">
            <form method="POST" action="" >

                {% if concert.Artist.ImageURL %}
                    <div>
                        <img class="img-fluid float-right img-thumbnail downsized"
                             src="/{{ concert.Artist.ImageURL }}"
                             title="{{ concert.Artist.Name }}"
                             alt="L'image pour «{{ concert.Artist.Name }}» est absente&nbsp;!">
                    </div>
                {% endif %}

                {% set selectedScene = concert.SceneName %}
                {{ block('selectForScene') }}

                <div class="form-group">
                    <label class="mr-2">
                        Date&nbsp:
                        <input type="date" name="DateLocale"
                                {# beware of the format we NEED to the browser : "Y-m-d"! #}
                               value="{{ concert.Date | date('Y-m-d') }}">
                    </label>

                    <label>
                        Heure&nbsp:
                        <input type="hour" name="hour"
                               value="{{ concert.hour }}">
                    </label>
                </div>

                {% set selectedArtist = concert.Artist.Name %}
                {{ block('selectForArtist') }}

                <div class="form-group">
                    <label class="form-group">
                        <strong>Concert annulé</strong>
                        <input type="checkbox" name="cancelled"
                               {% if concert.cancelled %}checked{% endif %}>
                    </label>

                    <button type="submit" name="delete-{{ concert.Id }}"
                            class="btn btn-danger m-2 float-right"
                            title="Supprimer ce concert (après confirmation)">
                        <span class="badge badge-light">
                            <img src="/assets/images/trashcan.svg" alt="">
                        </span>
                        Supprimer ...
                    </button>

                    <button type="submit" name="modify-{{ concert.Id }}"
                            class="btn btn-primary m-2 float-right"
                            title="Envoyer les changements effectués vers le serveur">
                        <span class="badge badge-light">
                            <img src="/assets/images/cloud-upload.svg" alt="">
                        </span>
                        Envoyer
                    </button>

                    <button type="reset" class="btn btn-secondary m-2 float-right"
                            title="annuler les changements effectués pour ce concert">
                        <span class="badge badge-light">
                            <img src="/assets/images/sync.svg" alt="">
                        </span>
                        Annuler
                    </button>


                </div>

            </form>
        </article>

       {% else %}
        <article>
            <p>Aucun événement enregistré</p>
        </article>

       {% endfor %}

    </main>
{% endblock %}


{% endautoescape %}
